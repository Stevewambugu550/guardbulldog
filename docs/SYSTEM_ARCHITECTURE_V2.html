<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardBulldog System Architecture V2.0</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #1a1a1a;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 900;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            padding: 0 40px;
        }
        
        .tab {
            padding: 15px 30px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            color: #FFA500;
        }
        
        .tab.active {
            color: #FFA500;
            border-bottom-color: #FFA500;
        }
        
        .content {
            padding: 40px;
        }
        
        .diagram-section {
            display: none;
        }
        
        .diagram-section.active {
            display: block;
        }
        
        .section-title {
            font-size: 2em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #FFD700;
        }
        
        .description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            line-height: 1.8;
        }
        
        .diagram-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }
        
        .legend {
            background: #fff9e6;
            border-left: 4px solid #FFD700;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
        }
        
        .legend h3 {
            color: #FFA500;
            margin-bottom: 15px;
        }
        
        .legend ul {
            list-style: none;
            padding-left: 0;
        }
        
        .legend li {
            padding: 8px 0;
            border-bottom: 1px solid #ffe6a3;
        }
        
        .legend li:last-child {
            border-bottom: none;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 25px;
            transition: all 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #FFD700;
        }
        
        .feature-card h3 {
            color: #FFA500;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feature-icon {
            font-size: 1.5em;
        }
        
        @media print {
            body {
                background: white;
            }
            .tabs {
                display: none;
            }
            .diagram-section {
                display: block !important;
                page-break-after: always;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è GUARDBULLDOG</h1>
            <p>System Architecture & Design - Version 2.0</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Enhanced Features: AI Detection, Guest Access, IP Intelligence</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">System Overview</button>
            <button class="tab" onclick="showTab('dataflow')">Data Flow</button>
            <button class="tab" onclick="showTab('ai-system')">AI Detection System</button>
            <button class="tab" onclick="showTab('database')">Database Architecture</button>
            <button class="tab" onclick="showTab('security')">Security Architecture</button>
        </div>
        
        <div class="content">
            <!-- OVERVIEW TAB -->
            <div id="overview" class="diagram-section active">
                <h2 class="section-title">System Overview Architecture</h2>
                
                <div class="description">
                    <p><strong>GuardBulldog V2.0</strong> is an enhanced enterprise-grade phishing awareness and reporting platform. The system integrates AI-powered threat detection, guest reporting capabilities, and comprehensive threat intelligence to provide real-time protection for Bowie State University.</p>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
graph TB
    subgraph "Frontend Layer"
        A[Web Application<br/>React + TailwindCSS]
        B[Guest Portal]
        C[User Dashboard]
        D[Admin Console]
    end
    
    subgraph "API Gateway"
        E[Express.js Server<br/>REST API]
        F[Authentication Middleware<br/>JWT]
        G[Rate Limiting]
    end
    
    subgraph "Business Logic Layer"
        H[Report Controller]
        I[AI Detection Engine]
        J[IP Intelligence]
        K[User Management]
        L[Inquiry System]
    end
    
    subgraph "Data Layer"
        M[(PostgreSQL<br/>Main Database)]
        N[File Storage<br/>Report Attachments]
        O[Session Store]
    end
    
    subgraph "External Services"
        P[IP Geolocation API]
        Q[Threat Intelligence Feeds]
        R[Email Parser]
    end
    
    A --> E
    B --> E
    C --> E
    D --> E
    
    E --> F
    E --> G
    F --> H
    F --> I
    F --> J
    F --> K
    F --> L
    
    H --> M
    I --> M
    J --> M
    K --> M
    L --> M
    
    H --> N
    I --> R
    J --> P
    J --> Q
    
    style A fill:#4CAF50
    style B fill:#FFD700
    style C fill:#2196F3
    style D fill:#FF5722
    style I fill:#9C27B0
    style M fill:#FF9800
                    </div>
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3><span class="feature-icon">üë§</span>Guest Access</h3>
                        <p>Allows anonymous reporting with tracking tokens. No login required for quick submissions.</p>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">ü§ñ</span>AI Detection</h3>
                        <p>Machine learning-powered phishing detection with 90%+ accuracy and real-time threat assessment.</p>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üåê</span>IP Intelligence</h3>
                        <p>Geolocation tracking, reputation scoring, and blacklist management for sender IP addresses.</p>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üìä</span>Analytics Dashboard</h3>
                        <p>Real-time threat visualization, trend analysis, and comprehensive reporting tools.</p>
                    </div>
                </div>
                
                <div class="legend">
                    <h3>üîë Key Components</h3>
                    <ul>
                        <li><strong>Frontend Layer:</strong> User interfaces for different roles and access levels</li>
                        <li><strong>API Gateway:</strong> Central entry point with security and rate limiting</li>
                        <li><strong>Business Logic:</strong> Core application features and intelligence systems</li>
                        <li><strong>Data Layer:</strong> Persistent storage for all application data</li>
                        <li><strong>External Services:</strong> Third-party integrations for enhanced capabilities</li>
                    </ul>
                </div>
            </div>
            
            <!-- DATA FLOW TAB -->
            <div id="dataflow" class="diagram-section">
                <h2 class="section-title">Data Flow Architecture</h2>
                
                <div class="description">
                    <p>This diagram illustrates how data flows through the GuardBulldog system from the moment a phishing report is submitted until it's resolved, including all enhancement features.</p>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
sequenceDiagram
    participant U as User/Guest
    participant F as Frontend
    participant API as API Server
    participant AI as AI Detection
    participant IP as IP Intelligence
    participant DB as Database
    participant Admin as Admin Console
    
    U->>F: Submit Phishing Report
    F->>API: POST /api/reports/submit
    
    Note over API: Validate Request<br/>Check Rate Limit
    
    API->>IP: Extract & Analyze IP
    IP->>DB: Store IP Intelligence
    IP-->>API: IP Risk Score
    
    API->>AI: Analyze Email Content
    
    Note over AI: Machine Learning<br/>Pattern Recognition<br/>URL Scanning
    
    AI->>DB: Store Detection Results
    AI-->>API: Threat Assessment
    
    API->>DB: Save Report with<br/>Risk Score & Classification
    
    DB-->>API: Report ID
    API-->>F: Success + Tracking Token
    F-->>U: Confirmation with Token
    
    Note over Admin: Real-time Alert<br/>if High Risk
    
    Admin->>API: Review Report
    API->>DB: Fetch Details
    DB-->>API: Report + AI Analysis
    API-->>Admin: Complete Report Data
    
    Admin->>API: Update Status/Add Notes
    API->>DB: Update Report
    DB-->>API: Success
    API-->>Admin: Confirmation
    
    Note over U: Receives Status<br/>Update Notification
                    </div>
                </div>
                
                <div class="legend">
                    <h3>üìà Data Flow Stages</h3>
                    <ul>
                        <li><strong>Stage 1:</strong> Report Submission - User/guest submits suspected phishing email</li>
                        <li><strong>Stage 2:</strong> IP Analysis - Sender IP extracted and analyzed for threats</li>
                        <li><strong>Stage 3:</strong> AI Detection - Content analyzed using machine learning models</li>
                        <li><strong>Stage 4:</strong> Data Storage - Report saved with threat intelligence</li>
                        <li><strong>Stage 5:</strong> Admin Review - Security team investigates and responds</li>
                        <li><strong>Stage 6:</strong> Resolution - Status updated and user notified</li>
                    </ul>
                </div>
            </div>
            
            <!-- AI SYSTEM TAB -->
            <div id="ai-system" class="diagram-section">
                <h2 class="section-title">AI Phishing Detection System</h2>
                
                <div class="description">
                    <p>The AI Detection Engine uses a multi-layered approach combining rule-based analysis, machine learning, and threat intelligence to accurately identify phishing attempts.</p>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
graph LR
    subgraph "Input Processing"
        A[Email Content] --> B[Text Extraction]
        A --> C[URL Extraction]
        A --> D[Header Parsing]
    end
    
    subgraph "Feature Analysis"
        B --> E[NLP Processing]
        C --> F[URL Analysis]
        D --> G[Metadata Extraction]
        
        E --> H[Sentiment Analysis]
        E --> I[Urgency Detection]
        E --> J[Language Patterns]
        
        F --> K[Domain Check]
        F --> L[SSL Verification]
        F --> M[Blacklist Lookup]
    end
    
    subgraph "Detection Layers"
        H --> N[Rule-Based<br/>Detection]
        I --> N
        J --> N
        K --> N
        L --> N
        M --> N
        
        N --> O[ML Classification<br/>Model]
        G --> O
        
        O --> P[Risk Scoring<br/>Engine]
    end
    
    subgraph "Output"
        P --> Q{Risk Score}
        Q -->|0-30| R[‚úÖ Safe]
        Q -->|31-60| S[‚ö†Ô∏è Suspicious]
        Q -->|61-80| T[üö® Phishing]
        Q -->|81-100| U[‚ò†Ô∏è Malware]
    end
    
    style A fill:#4CAF50
    style O fill:#9C27B0
    style P fill:#FF5722
    style R fill:#4CAF50
    style S fill:#FFD700
    style T fill:#FF9800
    style U fill:#F44336
                    </div>
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3><span class="feature-icon">üìù</span>Content Analysis</h3>
                        <ul style="margin-top: 10px; line-height: 1.8;">
                            <li>Urgency language detection</li>
                            <li>Credential request patterns</li>
                            <li>Spelling/grammar analysis</li>
                            <li>Brand impersonation detection</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üîó</span>URL Analysis</h3>
                        <ul style="margin-top: 10px; line-height: 1.8;">
                            <li>Domain similarity checking</li>
                            <li>Shortened URL expansion</li>
                            <li>SSL certificate validation</li>
                            <li>Blacklist database lookup</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üìä</span>Machine Learning</h3>
                        <ul style="margin-top: 10px; line-height: 1.8;">
                            <li>Supervised learning models</li>
                            <li>Historical pattern recognition</li>
                            <li>Continuous model training</li>
                            <li>Feedback incorporation</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üéØ</span>Risk Scoring</h3>
                        <ul style="margin-top: 10px; line-height: 1.8;">
                            <li>0-100 numerical scale</li>
                            <li>Confidence percentage</li>
                            <li>Detailed indicator reporting</li>
                            <li>Actionable recommendations</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- DATABASE TAB -->
            <div id="database" class="diagram-section">
                <h2 class="section-title">Database Architecture</h2>
                
                <div class="description">
                    <p>Enhanced database schema supporting all V2.0 features including guest reports, IP intelligence, threat detection, and user inquiries.</p>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
erDiagram
    USERS ||--o{ REPORTS : submits
    USERS ||--o{ USER_INQUIRIES : creates
    USERS {
        int id PK
        string email UK
        string password_hash
        string name
        string role
        string user_type
        string department
        int vulnerability_score
        timestamp created_at
    }
    
    REPORTS ||--o{ EMAIL_SOURCES : has
    REPORTS ||--o{ PHISHING_DETECTION : analyzed_by
    REPORTS ||--o{ REPORT_NOTES : has
    REPORTS {
        int id PK
        int user_id FK
        string subject
        text description
        string status
        int risk_score
        string auto_classification
        timestamp created_at
    }
    
    GUEST_REPORTS ||--o{ EMAIL_SOURCES : has
    GUEST_REPORTS ||--o{ PHISHING_DETECTION : analyzed_by
    GUEST_REPORTS {
        int id PK
        string tracking_token UK
        string email
        string subject
        text description
        string status
        string ip_address
        timestamp created_at
    }
    
    EMAIL_SOURCES {
        int id PK
        int report_id FK
        int guest_report_id FK
        string sender_email
        string sender_ip
        string sender_domain
        jsonb email_headers
        timestamp created_at
    }
    
    IP_INTELLIGENCE ||--o{ EMAIL_SOURCES : tracks
    IP_INTELLIGENCE {
        int id PK
        string ip_address UK
        string country
        string threat_level
        int reputation_score
        bool is_blacklisted
        int report_count
    }
    
    PHISHING_DETECTION {
        int id PK
        int report_id FK
        int guest_report_id FK
        int risk_score
        string classification
        decimal confidence_level
        jsonb indicators_found
        timestamp analyzed_at
    }
    
    USER_INQUIRIES ||--o{ INQUIRY_RESPONSES : has
    USER_INQUIRIES {
        int id PK
        int user_id FK
        string guest_email
        string subject
        text message
        string priority
        string status
        timestamp created_at
    }
    
    INQUIRY_RESPONSES {
        int id PK
        int inquiry_id FK
        text message
        bool is_admin_response
        timestamp created_at
    }
                    </div>
                </div>
                
                <div class="legend">
                    <h3>üóÑÔ∏è Database Tables</h3>
                    <ul>
                        <li><strong>Core Tables:</strong> users, reports, report_notes (existing)</li>
                        <li><strong>Guest System:</strong> guest_reports (new)</li>
                        <li><strong>Intelligence:</strong> ip_intelligence, email_sources, phishing_detection_results (new)</li>
                        <li><strong>Communication:</strong> user_inquiries, inquiry_responses (new)</li>
                        <li><strong>Threat Data:</strong> threat_indicators (new)</li>
                    </ul>
                </div>
            </div>
            
            <!-- SECURITY TAB -->
            <div id="security" class="diagram-section">
                <h2 class="section-title">Security Architecture</h2>
                
                <div class="description">
                    <p>Multi-layered security approach protecting the platform from attacks while maintaining usability and performance.</p>
                </div>
                
                <div class="diagram-container">
                    <div class="mermaid">
graph TB
    subgraph "External Layer"
        A[Internet] --> B[HTTPS/TLS<br/>SSL Encryption]
        B --> C[DDoS Protection<br/>Cloudflare/Netlify]
    end
    
    subgraph "Application Layer"
        C --> D[Rate Limiting<br/>Brute Force Prevention]
        D --> E[CORS Policy<br/>Origin Validation]
        E --> F[Input Sanitization<br/>XSS Prevention]
    end
    
    subgraph "Authentication Layer"
        F --> G{Authenticated?}
        G -->|Yes| H[JWT Validation<br/>Token Verification]
        G -->|No - Guest| I[Session Tracking<br/>Rate Limiting]
        H --> J[Role-Based Access<br/>Permissions Check]
        I --> K[Guest Capabilities<br/>Limited Access]
    end
    
    subgraph "Data Layer"
        J --> L[Parameterized Queries<br/>SQL Injection Prevention]
        K --> L
        L --> M[Data Encryption<br/>At Rest]
        M --> N[(Secure Database<br/>PostgreSQL)]
    end
    
    subgraph "Monitoring"
        O[Audit Logging]
        P[Intrusion Detection]
        Q[Security Alerts]
        
        L --> O
        H --> O
        I --> O
        O --> P
        P --> Q
    end
    
    style B fill:#4CAF50
    style H fill:#2196F3
    style L fill:#FF5722
    style N fill:#FF9800
    style Q fill:#F44336
                    </div>
                </div>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3><span class="feature-icon">üîí</span>Authentication</h3>
                        <ul style="margin-top: 10px;">
                            <li>JWT tokens (7-day expiry)</li>
                            <li>Bcrypt password hashing</li>
                            <li>Email domain validation</li>
                            <li>Session management</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üõ°Ô∏è</span>Protection</h3>
                        <ul style="margin-top: 10px;">
                            <li>CORS configuration</li>
                            <li>Helmet.js security headers</li>
                            <li>Rate limiting per IP</li>
                            <li>Input validation</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üíæ</span>Data Security</h3>
                        <ul style="margin-top: 10px;">
                            <li>Encrypted connections</li>
                            <li>Parameterized SQL queries</li>
                            <li>File upload validation</li>
                            <li>Secure file storage</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3><span class="feature-icon">üìä</span>Monitoring</h3>
                        <ul style="margin-top: 10px;">
                            <li>Comprehensive audit logs</li>
                            <li>Failed login tracking</li>
                            <li>Suspicious activity alerts</li>
                            <li>Security event reporting</li>
                        </ul>
                    </div>
                </div>
                
                <div class="legend">
                    <h3>üîê Security Standards</h3>
                    <ul>
                        <li><strong>OWASP Top 10:</strong> Protection against all major web vulnerabilities</li>
                        <li><strong>FERPA Compliant:</strong> Protects student data privacy</li>
                        <li><strong>HTTPS Enforced:</strong> All communications encrypted</li>
                        <li><strong>Regular Audits:</strong> Periodic security assessments</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#FFD700',
                primaryTextColor: '#1a1a1a',
                primaryBorderColor: '#FFA500',
                lineColor: '#666',
                secondaryColor: '#f8f9fa',
                tertiaryColor: '#e9ecef'
            }
        });
        
        function showTab(tabName) {
            // Hide all sections
            const sections = document.querySelectorAll('.diagram-section');
            sections.forEach(section => section.classList.remove('active'));
            
            // Show selected section
            document.getElementById(tabName).classList.add('active');
            
            // Update tab styles
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
